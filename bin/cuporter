#!/usr/bin/env ruby

$LOAD_PATH.unshift File.expand_path('../../lib', __FILE__)
require 'cuporter'

filter_args = Cuporter::CLI::FilterArgsBuilder.new(Cuporter::CLI::Options[:tags]).args

report_class = Cuporter.const_get(Cuporter::CLI::Options[:report])
report = report_class.new(Cuporter::CLI::Options[:input_file] || Cuporter::CLI::Options[:input_dir],
                          filter_args)

formatter_class = Cuporter::Formatters.const_get(Cuporter::CLI::Options[:format])
formatter_class.new(report.report_node,
                    Cuporter::CLI::Options[:output],
                    Cuporter::CLI::Options[:numbers]).write
